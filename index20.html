<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>井字遊戲 - 作者:李振偉</title>
<style>
  body {
    font-family: Arial, sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 10px;
  }
  #gameMode {
    margin-bottom: 20px;
  }
  #board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-template-rows: repeat(3, 100px);
    gap: 5px;
    margin-bottom: 20px;
  }
  .cell {
    width: 100px;
    height: 100px;
    background: #f0f0f0;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 2em;
    cursor: pointer;
  }
  #stats {
    margin-top: 10px;
  }
  button {
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>井字遊戲 - 作者:李振偉</h1>

<label for="gameMode">選擇遊戲模式:</label>
<select id="gameMode">
  <option value="single">單人對 AI</option>
  <option value="double">雙人對戰</option>
</select>

<div id="board"></div>

<div id="status"></div>

<div id="stats">
  玩家 X 勝: <span id="xWins">0</span> |
  玩家 O 勝: <span id="oWins">0</span> |
  平手: <span id="ties">0</span>
</div>

<button id="resetBtn">重新開始</button>

<script>
const boardElement = document.getElementById('board');
const statusElement = document.getElementById('status');
const gameModeSelect = document.getElementById('gameMode');
const resetBtn = document.getElementById('resetBtn');

let board = Array(9).fill('');
let currentPlayer = 'X';
let gameMode = 'single';
let xWins = 0;
let oWins = 0;
let ties = 0;

// 初始化棋盤
function initBoard() {
  boardElement.innerHTML = '';
  for (let i = 0; i < 9; i++) {
    const cell = document.createElement('div');
    cell.classList.add('cell');
    cell.dataset.index = i;
    cell.addEventListener('click', onCellClick);
    boardElement.appendChild(cell);
  }
  statusElement.textContent = `玩家 ${currentPlayer} 的回合`;
}

function onCellClick(e) {
  const index = e.target.dataset.index;
  if (board[index] !== '') return;
  board[index] = currentPlayer;
  e.target.textContent = currentPlayer;

  if (checkWin(currentPlayer)) {
    statusElement.textContent = `玩家 ${currentPlayer} 獲勝！`;
    updateStats(currentPlayer);
    disableBoard();
    return;
  }

  if (board.every(cell => cell !== '')) {
    statusElement.textContent = '平手！';
    ties++;
    document.getElementById('ties').textContent = ties;
    return;
  }

  currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
  statusElement.textContent = `玩家 ${currentPlayer} 的回合`;

  if (gameMode === 'single' && currentPlayer === 'O') {
    aiMove();
  }
}

function checkWin(player) {
  const winPatterns = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  return winPatterns.some(pattern => 
    pattern.every(index => board[index] === player)
  );
}

function updateStats(winner) {
  if (winner === 'X') {
    xWins++;
    document.getElementById('xWins').textContent = xWins;
  } else {
    oWins++;
    document.getElementById('oWins').textContent = oWins;
  }
}

function disableBoard() {
  document.querySelectorAll('.cell').forEach(cell => {
    cell.removeEventListener('click', onCellClick);
  });
}

function aiMove() {
  let emptyIndexes = board.map((v, i) => v === '' ? i : null).filter(v => v !== null);
  let choice = emptyIndexes[Math.floor(Math.random() * emptyIndexes.length)];
  board[choice] = 'O';
  boardElement.children[choice].textContent = 'O';

  if (checkWin('O')) {
    statusElement.textContent = '玩家 O 獲勝！';
    updateStats('O');
    disableBoard();
    return;
  }

  if (board.every(cell => cell !== '')) {
    statusElement.textContent = '平手！';
    ties++;
    document.getElementById('ties').textContent = ties;
    return;
  }

  currentPlayer = 'X';
  statusElement.textContent = `玩家 ${currentPlayer} 的回合`;
}

// 監聽模式切換
gameModeSelect.addEventListener('change', () => {
  gameMode = gameModeSelect.value;
  resetGame();
});

// 重新開始
resetBtn.addEventListener('click', resetGame);

function resetGame() {
  board = Array(9).fill('');
  currentPlayer = 'X';
  initBoard();
}

initBoard();
</script>

</body>
</html>
