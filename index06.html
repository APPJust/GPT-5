<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>電子抽認卡 - 作者:李振偉</title>
  <style>
    :root{--bg:#f6f8fb;--card:#ffffff;--accent:#4f46e5;--muted:#6b7280}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","Helvetica Neue",Arial;background:var(--bg);color:#111}
    header{background:linear-gradient(90deg,#eef2ff,#fff);padding:18px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #e6e9ef}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#22c1c3);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    h1{font-size:18px;margin:0}
    header small{color:var(--muted);display:block}
    .author{font-size:14px;color:var(--muted)}

    .container{display:grid;grid-template-columns:260px 1fr;gap:18px;padding:18px;max-width:1100px;margin:22px auto}
    .panel{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(20,20,50,0.04)}

    /* sidebar */
    .decks-list{display:flex;flex-direction:column;gap:8px}
    .deck-item{padding:10px;border-radius:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
    .deck-item.active{background:linear-gradient(90deg,#eef2ff,#fff);border:1px solid #e2e8f0}
    .deck-controls{display:flex;gap:8px}
    button, .btn{background:var(--accent);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn.secondary{background:#eef2ff;color:var(--accent)}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid #eef2ff}
    input, textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef;margin-top:6px}
    label{font-size:13px;color:var(--muted)}

    /* main */
    .main-grid{display:grid;grid-template-columns:1fr 360px;gap:16px}
    .cards-list{display:flex;flex-direction:column;gap:8px;max-height:520px;overflow:auto;padding-right:4px}
    .card-row{display:flex;gap:8px;align-items:flex-start;padding:10px;border-radius:8px;border:1px solid #f1f5f9}
    .card-front{font-weight:600}
    .study-area{display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;min-height:320px}

    .flashcard{width:100%;max-width:540px;height:260px;background:linear-gradient(180deg,#fff,#fbfeff);border-radius:12px;display:flex;align-items:center;justify-content:center;padding:20px;box-shadow:0 20px 40px rgba(20,20,50,0.06);cursor:pointer;user-select:none;transition:transform .25s ease,box-shadow .25s ease}
    .flashcard.flipped{transform:rotateY(180deg)}
    .flashcard .content{font-size:20px;text-align:center}
    .controls{display:flex;gap:8px}
    .muted{color:var(--muted);font-size:14px}

    footer{padding:12px 20px;text-align:center;color:var(--muted);font-size:13px}

    @media (max-width:900px){.container{grid-template-columns:1fr;padding:12px}.main-grid{grid-template-columns:1fr}.decks-list{flex-direction:row;overflow:auto}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">EF</div>
      <div>
        <h1>電子抽認卡</h1>
        <small>建立、編輯、刪除卡片組並進行翻面複習</small>
      </div>
    </div>
    <div class="author">作者: 李振偉</div>
  </header>

  <div class="container">
    <aside class="panel">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <strong>卡片組</strong>
        <div><button id="newDeckBtn" class="btn">新增</button></div>
      </div>
      <div class="decks-list" id="decksList"></div>
      <hr style="margin:12px 0;border:none;border-top:1px solid #f1f5f9">
      <div>
        <label>匯入 / 匯出</label>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="exportBtn" class="btn secondary">匯出</button>
          <button id="importBtn" class="btn ghost">匯入</button>
        </div>
        <input type="file" id="importFile" style="display:none;margin-top:8px" accept="application/json" />
      </div>
    </aside>

    <main class="panel">
      <div class="main-grid">
        <section>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div>
              <strong id="deckTitle">請選擇或建立一個卡片組</strong>
              <div id="deckCount" class="muted"></div>
            </div>
            <div class="deck-controls">
              <button id="studyBtn" class="btn" disabled>開始複習</button>
              <button id="editDeckBtn" class="btn secondary" disabled>編輯</button>
              <button id="deleteDeckBtn" class="btn ghost" disabled>刪除</button>
            </div>
          </div>

          <div style="margin-bottom:12px">
            <details>
              <summary style="cursor:pointer">新增卡片</summary>
              <div style="margin-top:8px">
                <label>正面 (問題)</label>
                <textarea id="cardFront" rows="2"></textarea>
                <label>背面 (答案)</label>
                <textarea id="cardBack" rows="2"></textarea>
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button id="addCardBtn" class="btn">加入卡片</button>
                  <button id="clearInputs" class="btn secondary">清除</button>
                </div>
              </div>
            </details>
          </div>

          <div>
            <strong>卡片列表</strong>
            <div class="cards-list" id="cardsList">
              <div class="muted" id="noCardsHint">請選擇卡片組或新增卡片。</div>
            </div>
          </div>
        </section>

        <aside>
          <div>
            <strong>預覽 / 練習</strong>
            <div class="study-area" id="studyArea">
              <div class="muted">選擇卡片組後，點「開始複習」</div>
            </div>
            <div style="display:flex;justify-content:center;margin-top:12px;gap:8px">
              <button id="prevBtn" class="btn secondary" disabled>上一張</button>
              <button id="flipHint" class="btn ghost" disabled>點擊卡片翻面</button>
              <button id="nextBtn" class="btn secondary" disabled>下一張</button>
            </div>
          </div>
        </aside>
      </div>
    </main>
  </div>

  <footer>本應用將資料儲存在您的瀏覽器 Local Storage (本機)。</footer>

  <script>
    // Data model in localStorage: {decks: [{id, name, cards:[{id,front,back}]}]}
    const LS_KEY = 'ef_flashcards_v1';
    let state = {decks:[]};
    let selectedDeckId = null;
    let studyIndex = 0;
    let studying = false;
    let flipped = false;

    // Utilities
    const $ = id => document.getElementById(id);
    const uid = () => Math.random().toString(36).slice(2,9);
    function save(){localStorage.setItem(LS_KEY, JSON.stringify(state));}
    function load(){try{const raw=localStorage.getItem(LS_KEY);state=raw?JSON.parse(raw):{decks:[]};}catch(e){state={decks:[]};}}

    // Rendering
    function renderDecks(){
      const container = $('decksList');container.innerHTML='';
      state.decks.forEach(d=>{
        const el = document.createElement('div');
        el.className='deck-item'+(d.id===selectedDeckId? ' active':'');
        el.innerHTML = `<div style="flex:1">${escapeHtml(d.name)}</div><div style="display:flex;gap:6px"><button class='btn secondary' data-id='${d.id}' data-action='rename'>重新命名</button><button class='btn ghost' data-id='${d.id}' data-action='select'>開啟</button></div>`;
        container.appendChild(el);
      });
    }

    function renderSelectedDeck(){
      const title = $('deckTitle'); const count = $('deckCount'); const cardsList = $('cardsList');
      const deck = state.decks.find(x=>x.id===selectedDeckId);
      if(!deck){title.textContent='請選擇或建立一個卡片組'; count.textContent=''; cardsList.innerHTML=`<div class='muted' id='noCardsHint'>請選擇卡片組或新增卡片。</div>`; $('studyBtn').disabled=true; $('editDeckBtn').disabled=true; $('deleteDeckBtn').disabled=true; return;}
      title.textContent = deck.name; count.textContent = `${deck.cards.length} 張卡片`;
      $('studyBtn').disabled = deck.cards.length===0?true:false;
      $('editDeckBtn').disabled=false; $('deleteDeckBtn').disabled=false;

      cardsList.innerHTML='';
      if(deck.cards.length===0){cardsList.innerHTML='<div class="muted">尚無卡片，使用上方表單新增。</div>';return}
      deck.cards.forEach(c=>{
        const row = document.createElement('div');row.className='card-row';
        row.innerHTML = `
          <div style='flex:1'>
            <div class='card-front'>${escapeHtml(c.front)}</div>
            <div class='muted' style='margin-top:6px'>${escapeHtml(c.back)}</div>
          </div>
          <div style='display:flex;flex-direction:column;gap:6px'>
            <button class='btn' data-action='edit' data-id='${c.id}'>編輯</button>
            <button class='btn ghost' data-action='delete' data-id='${c.id}'>刪除</button>
          </div>`;
        cardsList.appendChild(row);
      });
    }

    function renderStudyArea(){
      const area = $('studyArea'); area.innerHTML='';
      const deck = state.decks.find(d=>d.id===selectedDeckId);
      if(!deck){area.innerHTML='<div class="muted">選擇卡片組後，點「開始複習」</div>'; return}
      if(deck.cards.length===0){area.innerHTML='<div class="muted">卡片組內沒有卡片</div>'; return}

      const card = deck.cards[studyIndex % deck.cards.length];
      const fc = document.createElement('div');fc.className='flashcard';fc.tabIndex=0;
      const inner = document.createElement('div');inner.className='content';inner.innerHTML = flipped? escapeHtml(card.back) : escapeHtml(card.front);
      fc.appendChild(inner);
      fc.addEventListener('click',()=>{flipped=!flipped; inner.innerHTML=flipped?escapeHtml(card.back):escapeHtml(card.front); fc.classList.toggle('flipped',flipped); updateStudyControls();});
      area.appendChild(fc);
      updateStudyControls();
    }

    function updateStudyControls(){
      const deck = state.decks.find(d=>d.id===selectedDeckId);
      const len = deck?deck.cards.length:0;
      $('prevBtn').disabled = !studying || len===0;
      $('nextBtn').disabled = !studying || len===0;
      $('flipHint').disabled = !studying || len===0;
    }

    // Events
    function bindEvents(){
      $('newDeckBtn').addEventListener('click',()=>{
        const name = prompt('請輸入卡片組名稱：','新卡片組'); if(!name) return;
        const deck = {id:uid(), name:name.trim(), cards:[]}; state.decks.push(deck); save(); selectedDeckId = deck.id; studyIndex=0; renderAll();
      });

      $('decksList').addEventListener('click',e=>{
        const btn = e.target.closest('button'); if(!btn) return; const id = btn.dataset.id; const action = btn.dataset.action;
        if(action==='select'){ selectedDeckId = id; studyIndex=0; renderAll(); }
        if(action==='rename'){ const d = state.decks.find(x=>x.id===id); const newName = prompt('請輸入新的名稱：',d.name); if(newName){d.name=newName.trim(); save(); renderAll();} }
      });

      $('addCardBtn').addEventListener('click',()=>{
        const front = $('cardFront').value.trim(); const back = $('cardBack').value.trim();
        if(!selectedDeckId){alert('請先選擇卡片組');return}
        if(!front || !back){alert('請填寫正反面內容');return}
        const deck = state.decks.find(d=>d.id===selectedDeckId);
        deck.cards.push({id:uid(), front, back}); save(); $('cardFront').value=''; $('cardBack').value=''; renderAll();
      });

      $('clearInputs').addEventListener('click',()=>{$('cardFront').value='';$('cardBack').value='';});

      $('cardsList').addEventListener('click',e=>{
        const btn = e.target.closest('button'); if(!btn) return; const id = btn.dataset.id; const action = btn.dataset.action;
        const deck = state.decks.find(d=>d.id===selectedDeckId);
        if(!deck) return;
        if(action==='delete'){ if(confirm('確定刪除此卡片？')){ deck.cards = deck.cards.filter(c=>c.id!==id); save(); renderAll(); } }
        if(action==='edit'){ const card = deck.cards.find(c=>c.id===id); const front = prompt('編輯正面', card.front); if(front===null) return; const back = prompt('編輯背面', card.back); if(back===null) return; card.front=front.trim(); card.back=back.trim(); save(); renderAll(); }
      });

      $('deleteDeckBtn').addEventListener('click',()=>{
        if(!selectedDeckId) return; if(!confirm('確定刪除整個卡片組？此動作不可還原')) return; state.decks = state.decks.filter(d=>d.id!==selectedDeckId); selectedDeckId=null; save(); renderAll();
      });

      $('editDeckBtn').addEventListener('click',()=>{ const d = state.decks.find(x=>x.id===selectedDeckId); const n = prompt('編輯卡片組名稱：', d.name); if(n){d.name=n.trim(); save(); renderAll();}});

      $('studyBtn').addEventListener('click',()=>{
        const deck = state.decks.find(d=>d.id===selectedDeckId); if(!deck || deck.cards.length===0) return; studying = true; studyIndex=0; flipped=false; renderStudyArea();
      });

      $('prevBtn').addEventListener('click',()=>{ const deck = state.decks.find(d=>d.id===selectedDeckId); if(!deck) return; studyIndex = (studyIndex - 1 + deck.cards.length) % deck.cards.length; flipped=false; renderStudyArea(); });
      $('nextBtn').addEventListener('click',()=>{ const deck = state.decks.find(d=>d.id===selectedDeckId); if(!deck) return; studyIndex = (studyIndex + 1) % deck.cards.length; flipped=false; renderStudyArea(); });

      // export/import
      $('exportBtn').addEventListener('click',()=>{
        const dataStr = JSON.stringify(state, null, 2); const blob = new Blob([dataStr],{type:'application/json'}); const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download = `flashcards_${new Date().toISOString().slice(0,10)}.json`; a.click(); URL.revokeObjectURL(url);
      });
      $('importBtn').addEventListener('click',()=>{$('importFile').click();});
      $('importFile').addEventListener('change',async e=>{
        const f = e.target.files[0]; if(!f) return; try{ const txt = await f.text(); const obj = JSON.parse(txt); if(!obj.decks) throw new Error('格式錯誤'); state = obj; save(); selectedDeckId=null; renderAll(); alert('匯入完成'); }catch(err){alert('匯入失敗: '+err.message)} finally{e.target.value=''}
      });

      // Keyboard shortcuts for study
      document.addEventListener('keydown',e=>{
        if(!studying) return;
        if(e.key==='ArrowRight') $('nextBtn').click();
        if(e.key==='ArrowLeft') $('prevBtn').click();
        if(e.key===' ') { e.preventDefault(); const c = document.querySelector('.flashcard'); if(c) c.click(); }
      });

      // click deck row to select
      $('decksList').addEventListener('click', e=>{
        const item = e.target.closest('.deck-item'); if(item){
          // find by displayed name (fallback) - better to handle via select button
        }
      });

      // helper: double click deck name to select
      $('decksList').addEventListener('dblclick', e=>{ const el = e.target.closest('.deck-item'); if(!el) return; const index = Array.from(el.parentElement.children).indexOf(el); const deck = state.decks[index]; if(deck){ selectedDeckId = deck.id; studyIndex=0; renderAll(); } });
    }

    // helpers
    function escapeHtml(s){return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

    function renderAll(){ renderDecks(); renderSelectedDeck(); renderStudyArea(); }

    // init
    load(); bindEvents(); renderAll();

    // create sample deck if none
    if(state.decks.length===0){ state.decks.push({id:uid(), name:'範例: 英語單字', cards:[{id:uid(),front:'Apple',back:'蘋果'},{id:uid(),front:'Book',back:'書籍'},{id:uid(),front:'Cat',back:'貓'}]}); save(); renderAll(); }
  </script>
</body>
</html>